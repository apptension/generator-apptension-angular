# -*- mode: ruby -*-
# vi: set ft=ruby :

unless Vagrant.has_plugin?("vagrant-docker-compose")
  system("vagrant plugin install vagrant-docker-compose")
  puts "Dependencies installed, please try the command again."
  exit
end

Vagrant.configure(2) do |config|
  config.vm.box = "ubuntu/trusty64"

  config.vm.network "forwarded_port", guest: 8080, host: 8080
  config.vm.network "forwarded_port", guest: 3000, host: 3000

  config.vm.provider "virtualbox" do |v|
    v.memory = 2048
  end

  config.vm.provision :docker do |d|
    d.build_image "/vagrant/config/docker-devel-base",
      args: "-t devel/base"
  end

  config.vm.provision :docker_compose,
    yml: "/vagrant/config/docker-devel-compose.yml",
    rebuild: true,
    run: "always"

  config.vm.provision "shell",
    :path => "config/vagrant-devel-startup.sh",
    run: "always"
end
